##  ICC Point Table
```sql
CREATE TABLE ICC_WORLD_CUP
(
TEAM_1 VARCHAR(20),
TEAM_2 VARCHAR(20),
WINNER VARCHAR(20)
);
INSERT INTO ICC_WORLD_CUP VALUES('India','SL','India');
INSERT INTO ICC_WORLD_CUP VALUES('SL','Aus','Aus');
INSERT INTO ICC_WORLD_CUP VALUES('SA','Eng','Eng');
INSERT INTO ICC_WORLD_CUP VALUES('Eng','NZ','NZ');
INSERT INTO ICC_WORLD_CUP VALUES('Aus','India','India');

SELECT 
  TEAM_NAME, 
  COUNT(*) AS MATCHES_PLAYED, 
  SUM(WIN_FLAG) AS NO_OF_WINS, 
  COUNT(*)- SUM(WIN_FLAG) AS NO_OF_LOSSES 
FROM 
  (
    SELECT 
      TEAM_1 AS TEAM_NAME, 
      CASE WHEN WINNER = TEAM_1 THEN 1 ELSE 0 END AS WIN_FLAG 
    FROM 
      ICC_WORLD_CUP 
    UNION ALL 
    SELECT 
      TEAM_2 AS TEAM_NAME, 
      CASE WHEN WINNER = TEAM_2 THEN 1 ELSE 0 END AS WIN_FLAG 
    FROM 
      ICC_WORLD_CUP
  ) DATA 
GROUP BY 
  TEAM_NAME 
ORDER BY 
  3 DESC;
```
##  Employees having salary greater than manager
```sql
CREATE TABLE EMP(
  EMP_ID INT, 
  EMP_NAME VARCHAR(10), 
  SALARY INT, 
  MANAGER_ID INT
);

INSERT INTO EMP VALUES(1,'Ankit',10000,4);
INSERT INTO EMP VALUES(2,'Mohit',15000,5);
INSERT INTO EMP VALUES(3,'Vikas',10000,4);
INSERT INTO EMP VALUES(4,'Rohit',5000,2);
INSERT INTO EMP VALUES(5,'Mudit',12000,6);
INSERT INTO EMP VALUES(6,'Agam',12000,2);
INSERT INTO EMP VALUES(7,'Sanjay',9000,2);
INSERT INTO EMP VALUES(8,'Ashish',5000,2);

SELECT * FROM EMP;

SELECT 
  E.EMP_ID, 
  E.EMP_NAME, 
  M.EMP_NAME AS MANAGER_NAME, 
  E.SALARY, 
  M.SALARY AS MANAGER_SALARY 
FROM 
  EMP E 
  LEFT JOIN EMP M ON E.MANAGER_ID = M.EMP_ID 
WHERE 
  E.SALARY > M.SALARY
```
##  New and Repeat Customers
```sql
CREATE TABLE CUSTOMER_ORDERS (
  ORDER_ID INTEGER,
  CUSTOMER_ID INTEGER,
  ORDER_DATE DATE,
  ORDER_AMOUNT INTEGER
);

INSERT INTO CUSTOMER_ORDERS VALUES
(1,100,CAST('2022-01-01' AS DATE),2000),
(2,200,CAST('2022-01-01' AS DATE),2500),
(3,300,CAST('2022-01-01' AS DATE),2100),
(4,100,CAST('2022-01-02' AS DATE),2000),
(5,400,CAST('2022-01-02' AS DATE),2200),
(6,500,CAST('2022-01-02' AS DATE),2700),
(7,100,CAST('2022-01-03' AS DATE),3000),
(8,400,CAST('2022-01-03' AS DATE),1000),
(9,600,CAST('2022-01-03' AS DATE),3000);

SELECT * FROM CUSTOMER_ORDERS;

SELECT 
  A.ORDER_DATE, 
  COUNT(CASE WHEN B.CUSTOMER_ID IS NULL THEN 1 END) AS NEW_CUSTOMERS, 
  COUNT(DISTINCT B.CUSTOMER_ID) AS REPEAT_CUSTOMERS 
FROM 
  CUSTOMER_ORDERS A 
  LEFT JOIN CUSTOMER_ORDERS B ON A.ORDER_DATE > B.ORDER_DATE 
  AND A.CUSTOMER_ID = B.CUSTOMER_ID 
GROUP BY 
  A.ORDER_DATE;
  
WITH FIRST_VISIT AS (
  SELECT 
    CUSTOMER_ID, 
    MIN(ORDER_DATE) AS FIRST_VISIT_DATE 
  FROM 
    CUSTOMER_ORDERS 
  GROUP BY 
    CUSTOMER_ID
) 
SELECT 
  CO.ORDER_DATE, 
  SUM(
    CASE WHEN CO.ORDER_DATE = FV.FIRST_VISIT_DATE THEN 1 ELSE 0 END
  ) AS FIRST_VISIT_FLAG, 
  SUM(
    CASE WHEN CO.ORDER_DATE != FV.FIRST_VISIT_DATE THEN 1 ELSE 0 END
  ) AS REPEAT_VISIT_FLAG 
FROM 
  CUSTOMER_ORDERS CO 
  INNER JOIN FIRST_VISIT FV ON CO.CUSTOMER_ID = FV.CUSTOMER_ID 
GROUP BY 
  CO.ORDER_DATE;
```
## Most Visited Floor
```sql
CREATE TABLE ENTRIES (
  NAME VARCHAR(20), 
  ADDRESS VARCHAR(20), 
  EMAIL VARCHAR(20), 
  FLOOR INT, 
  RESOURCES VARCHAR(10)
);
INSERT INTO ENTRIES 
VALUES 
  ('A','Bangalore','A@gmail.com', 1,'CPU'), 
  ('A','Bangalore','A1@gmail.com',1,'CPU'), 
  ('A','Bangalore','A2@gmail.com',2,'DESKTOP'), 
  ('B','Bangalore','B@gmail.com', 2,'DESKTOP'), 
  ('B','Bangalore','B1@gmail.com',2,'DESKTOP'), 
  ('B','Bangalore','B2@gmail.com',1,'MONITOR');
SELECT 
  * 
FROM 
  ENTRIES;

WITH VISIT_DATA AS (
  SELECT 
    NAME, 
    FLOOR, 
    SUM(COUNT(FLOOR)) OVER (PARTITION BY NAME) AS TOTAL_VISIT, 
    RANK() OVER (PARTITION BY NAME ORDER BY COUNT(FLOOR) DESC) AS RNK 
  FROM 
    ENTRIES 
  GROUP BY 
    NAME, 
    FLOOR
), 
RESOURCES_DATA AS (
  SELECT 
    NAME, 
    STRING_AGG(RESOURCES, ',') AS RESOURCES_USED 
  FROM 
    (
      SELECT 
        DISTINCT NAME, RESOURCES 
      FROM 
        ENTRIES
    ) A 
  GROUP BY 
    NAME
) 
SELECT 
  A.NAME, 
  TOTAL_VISIT, 
  A.FLOOR AS MOST_VISITED_FLOOR, 
  RESOURCES_USED 
FROM 
  VISIT_DATA A 
  LEFT JOIN RESOURCES_DATA B ON A.NAME = B.NAME 
WHERE 
  RNK = 1
```